\section{Параллелизация вычислений}

Задача параллелизации представляет собой программное ускорение расчета полей накопленных энергий после соударения системы трех тел со стенкой в зависимости
от конфигурации системы. Расчет энергий происходит путем моделирования взаимодействия тел, что представляет собой решение системы ОДУ для каждого момента
времени при помощи метода Рунге-Кутта 4 порядка \cite{BahvalJidkovKobel1987}. Для понимания какой из параметров вносит больший вклад в накопление энергии 
требуется провести большое количество симуляций, которые линейно влияют на время расчетов. Было решено использовать возможности языка Golang, для программного
ускорения времени расчетов и более полного использования ресурсов компьютера, а в дальнейшем и вычислительного кластера.

Для ускорения вычисления были реализованы функции считающие двумерные поля(рисунок \ref{fig:2dalg}) и трехмерные облака точек(рисунок \ref{fig:3dalg}).
Обе функции используют все ядра центрального процессора.


Параллелизация работы в случае функции представленной в блок-схеме на рисунке \ref{fig:3dalg} достигается за счет того, что на каждую горутину выделяется одна плоскость в трехмерном пространстве, 
которую необходимо расчитать, после окончания расчета по каналу отправляется строковая переменная содержащая в себе данные расчетов, полученные данной горутиной.


\begin{figure}[!h]
    \centering
    \begin{minipage}[h]{0.49\linewidth}
        \centering
        \scalebox{0.45}{\input{img/tikz/paral2d.tikz}}
        \caption{Двумерная\\параллелизация}
        \label{fig:2dalg}
    \end{minipage}
    \begin{minipage}[h]{0.49\linewidth}
        \centering
        \scalebox{0.45}{\input{img/tikz/paral3d.tikz}}
        \caption{Трехмерная\\параллелизация}
        \label{fig:3dalg}
    \end{minipage}
    %\scalebox{0.45}{\input{img/tikz/paral2d.tikz}}
    %\caption{Двумерная параллелизация}
    %\label{fig:2dalg}
\end{figure}

\begin{figure}[!h]
    \centering
    \scalebox{0.45}{\input{img/tikz/var2mass.tikz}}
    \caption{Функция Variate}
    \label{fig:var2}
\end{figure}

Параллелизация работы в случае функции представленной в блок-схеме на рисунке \ref{fig:2dalg} достигается, за счет разделения плоскости расчетов между всеми доступными ядрами процессора,
что позволяет параллельно производить несколько симуляций. Во время расчетов, аналогично трехмерному случаю формируется строковая переменная, которая отправляется по каналу.

\begin{lstlisting}[label=lst:bar,language=Golang, caption=Функция барьер][t]
func barrier(nrouts int, ch chan string, fil *os.File) {
    for r := 0; r < nrouts; r++ {
        x := <-ch
        log.Println("goroutine ", r, "writed", len(x))
        fil.WriteString(x)
    }
}
\end{lstlisting}

Полученные через канал строки обрабатываются в функции представленной в листинге \ref{lst:bar}. Данная функция принимает по каналу определенное количество переменных типа строка,
которое равно число запущенных горутин, тем самым реализует работу барьера и блокирует выполнение родительской горутины до завершения работы всех дочерних горутин.
После строковая переменная записывается в файл для дальнейшей визуализации.